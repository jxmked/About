"use strict";var __awaiter=this&&this.__awaiter||function(e,a,c,s){return new(c=c||Promise)(function(n,t){function r(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(r,o)}i((s=s.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(r,o){var i,a,c,s={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(c=2&t[0]?a.return:t[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,t[1])).done)return c;switch(a=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(c=0<(c=s.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))s.label=t[1];else if(6===t[0]&&s.label<c[1])s.label=c[1],c=t;else{if(!(c&&s.label<c[2])){c[2]&&s.ops.pop(),s.trys.pop();continue}s.label=c[2],s.ops.push(t)}}t=o.call(r,s)}catch(e){t=[6,e],a=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},PP_Item_Create=(!function(){var e={pre_path:"jxmked"};window.GLOBAL_ENV=e}(),window.addEventListener("DOMContentLoaded",function(){return __awaiter(void 0,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:new NavigationPanel,NavigationPanel.addItem("Introduction","main-introduction"),NavigationPanel.addItem("About Me","main-about"),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,(new Config).load()];case 2:return(e.sent(),t=Config.config,t.github.username)?[4,(new getColors).then()]:(console.error("Github username does not exists"),[2]);case 3:return e.sent(),new MostLanguages,new PersonalProjects,[3,5];case 4:return t=e.sent(),console.error(t),console.error("Failed to parse userdata!"),console.error("Please check your inputs."),[3,5];case 5:return[2]}})})}),function(){function r(e){this.obj=e,this.parent=document.createElement("div"),this.parent.classList.add("pp-items"),this.parent.classList.add("observable"),this.name(),this.description(),this.topics(),this.graphs(),this.callback=function(e){}}return Object.defineProperty(r,"escaped_topics",{set:function(e){r.topicExceptions=e},enumerable:!1,configurable:!0}),r.prototype.name=function(){var e=document.createElement("a"),t=document.createElement("label");e.setAttribute("href",this.obj.html_url),e.setAttribute("rel","noopener noreferrer"),e.setAttribute("target","_blank"),e.appendChild(document.createTextNode(this.obj.full_name)),t.appendChild(e),this.parent.appendChild(t)},r.prototype.description=function(){var e='"No description provided."',t=document.createElement("p"),n=document.createElement("div");try{var r=String(this.obj.description).trim(),e=0==r.length?e:r}catch(e){}finally{t.appendChild(document.createTextNode(e)),n.appendChild(t),this.parent.appendChild(n)}},r.prototype.topics=function(){var n=document.createElement("ul"),e=document.createElement("div");this.obj.topics.forEach(function(e){var t;0<r.topicExceptions.length&&-1!=r.topicExceptions.indexOf(normalize(e))||((t=document.createElement("li")).appendChild(document.createTextNode(e.trim())),n.appendChild(t))}),e.appendChild(n),this.parent.appendChild(e)},r.prototype.graphs=function(){return __awaiter(this,void 0,void 0,function(){var o,i,a,c,s=this;return __generator(this,function(e){switch(e.label){case 0:return o=document.createElement("div"),i=document.createElement("ul"),c=0,[4,gh_fetch(this.obj.languages_url,1).then(function(e){a=ObjectSort(e),0<Object.entries(e).length&&(c=Object.values(a).reduce(function(e,t){return e+t})),Object.keys(a).forEach(function(e){var t=getColors.color(e),n=a[e]/c*100,r=(0==c&&(n=0),s.create_bar_graph(n,t)),r=(o.appendChild(r),s.create_ranking(e,n,t));i.appendChild(r)});e=document.createElement("div");e.appendChild(o),e.appendChild(i),s.parent.appendChild(e),s.callback(s.parent)}).catch(function(e){console.error(e)})];case 1:return e.sent(),[2]}})})},r.prototype.create_bar_graph=function(e,t){var n=document.createElement("span");return n.style.backgroundColor=t,n.style.width=String(e)+"%",n},r.prototype.create_ranking=function(e,t,n){var r=document.createElement("li"),o=document.createElement("span"),e=(o.style.backgroundColor=n,(n=document.createElement("p")).classList.add("language"),n.appendChild(document.createTextNode(e)),document.createElement("p")),t=parseFloat(String(t)).toFixed(2);return e.appendChild(document.createTextNode(t)),r.appendChild(o),r.appendChild(n),r.appendChild(e),r.classList.add("item"),r},r.prototype.then=function(e){this.callback=e},r.topicExceptions=[],r}()),MostLanguages=function(){function s(){var e=this,t=(this.repoLang={},s.username=Config.config.github.username,Config.config.github.mostly_used_languages.exception),n=Config.config.github.mostly_used_languages.max_display_language;s.maxLanguages=n,s.exceptLangs=t.map(function(e){return normalize(e)}),s.__is_initiated__||(s.__is_initiated__=!0,s.BASE.setAttribute("id","main-languages"),s.BASE.appendChild(s.PARENT),n=document.getElementById("main-about"),s.BASE.classList.add("observable"),n.parentNode.insertBefore(s.BASE,n.nextSibling),NavigationPanel.addItem("Known Languages","main-languages"),this.create_loading_container(),this.get_repositories(function(){e.beginCounting(),console.log(s.countedRepos)}))}return s.prototype.create_loading_container=function(){this.setLabel(),s.BASE.classList.add("loading");var e=document.createElement("div"),t=(e.classList.add("loading-state"),document.createElement("div")),n=document.createElement("div");t.appendChild(n),e.appendChild(t),e.appendChild(s.TEXT_LOADING_CONTAINER),s.TEXT_LOADING_CONTAINER.innerText="Loading...",s.PARENT.appendChild(e)},s.UpdateText=function(e,t){var n=e;(t=void 0===t?!1:t)&&(n="".concat(e," (").concat(s.countedRepos," out of ").concat(s.currentRepoCount,")")),s.TEXT_LOADING_CONTAINER.innerText=n},s.prototype.beginCounting=function(){var t=this,n=ObjectSort(s.countLangs);Object.keys(n).splice(0,s.maxLanguages).forEach(function(e){t.repoLang[e]=n[e]}),this.createObject()},s.prototype.get_repositories=function(e){var n=this,t="https://api.github.com/users/".concat(s.username,"/repos?per_page=50"),i=function(a,c,t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){return gh_fetch(a.languages_url,1).then(function(e,t){for(var n=0,r=Object.entries(e);n<r.length;n++){var o=r[n],i=o[0],o=o[1];-1==s.exceptLangs.indexOf(normalize(i))&&(s.countLangs[i]||(s.countLangs[i]=0),s.countLangs[i]+=o)}s.UpdateText(a.name,!0),t?console.info("Error: ".concat(a.name)):s.countedRepos++,c()},!0).catch(function(e){return t(e)}),[2]})})},a=function(n,r){var o=0,e=t;gh_fetch(e=1<n?"".concat(t,"&page=").concat(n):e,1).then(function(t){if(s.currentRepoCount+=t.length,0==t.length)r();else try{t.forEach(function(e){i(e,function(){o++,t.length==o&&a(n+1,r)},r)})}catch(e){r()}})},r=!1;a(1,function(){r||(e(),r=!0)})},s.prototype.createObjectAttribute=function(e,t,n){var r=document.createElement("span"),o=document.createElement("p"),i=document.createElement("span"),a=document.createElement("li"),e=(r.style.backgroundColor=e,r.setAttribute("data-value",e),a.appendChild(r),o.appendChild(document.createTextNode(n)),a.appendChild(o),parseFloat(t).toFixed(2));return i.appendChild(document.createTextNode("".concat(e,"%"))),i.setAttribute("data-value",t),a.appendChild(i),a},s.prototype.setLabel=function(e){void 0===e&&(e=!1);var t=document.createElement("label"),n=document.createElement("span");if(t.appendChild(document.createTextNode("Known Languages:")),n.appendChild(document.createTextNode("from Github")),n.classList.add("tooltip"),t.appendChild(n),e)return t;s.PARENT.appendChild(t)},s.prototype.createObject=function(){var e,o,i,a,t,n,c=this;Object.values(this.repoLang).length<1?s.UpdateText("No Entries Found"):(e=document.createElement("div"),o=Object.values(this.repoLang).reduce(function(e,t){return e+t}),t=ObjectSort(this.repoLang),i=document.createElement("div"),a=document.createElement("ul"),Object.entries(t).forEach(function(e){var t=e[0],e=e[1],e=String(e/o*100),n=getColors.color(t),r=document.createElement("span");r.style.backgroundColor=n,r.style.width=e+"%",r.setAttribute("data-value",e),i.appendChild(r),a.appendChild(c.createObjectAttribute(n,e,t))}),(t=document.createElement("div")).appendChild(i),(n=document.createElement("div")).appendChild(a),e.appendChild(this.setLabel(!0)),e.appendChild(t),e.appendChild(n),s.UpdateText("".concat(s.countedRepos," repositories loaded.")),window.setTimeout(function(){s.PARENT.remove(),s.BASE.classList.remove("loading"),s.BASE.appendChild(e)},1e3))},s.maxLanguages=0,s.exceptLangs=[],s.__is_initiated__=!1,s.currentRepoCount=0,s.countedRepos=0,s.countLangs={},s.BASE=document.createElement("div"),s.PARENT=document.createElement("div"),s.TEXT_LOADING_CONTAINER=document.createElement("span"),s}(),NavigationPanel=function(){function e(){document.getElementById("nav-panel").addEventListener("click",function(){document.getElementById("--cb-burger-menu").click()},!0)}return e.addItem=function(e,t){var n=[void 0,0,null,""];if(e=String(e).trim(),t=encodeURI(String(t)),-1!=n.indexOf(e)||-1!=n.indexOf(t))throw new Error("Unable to add");var n=document.createElement("li"),r=document.createElement("a");r.appendChild(document.createTextNode(e)),r.setAttribute("href","#".concat(t)),r.setAttribute("rel","noreferrer origin"),r.setAttribute("alt","Navigate to ".concat(e)),n.appendChild(r);try{document.getElementById("nav-panel-list").appendChild(n)}catch(e){console.error("Unable to insert element"),console.error(e)}},e}(),PersonalProjects=function(){function c(){var e=this,t=Config.config.github.username,n=Config.config.github.personal_projects.target_topics,r=Config.config.github.personal_projects.max_display_projects,o=Config.config.github.personal_projects.hide_projects;this.topicIncludes=n.map(function(e){return normalize(e)}),this.hideProjects=o.map(function(e){return normalize(e)}),this.maxProjects=Number(r),this.repositories=[],c.username=t,c.__is_initiated__||(c.__is_initiated__=!0,this.getAllRepositories(function(){e.__start__()}))}return c.prototype.getAllRepositories=function(a){return __awaiter(this,void 0,void 0,function(){var o,i,t=this;return __generator(this,function(e){return o="https://api.github.com/users/".concat(c.username,"/repos?per_page=50"),(i=function(r){return __awaiter(t,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){return t=o,gh_fetch(t=1<r?"".concat(o,"&page=").concat(r):t,1).then(function(e){n.repositories.length>=n.maxProjects||0==e.length?a():(n.repositories=n.repositories.concat(e),i(r+1))}),[2]})})})(1),[2]})})},c.prototype.__start__=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,i,a,c=this;return __generator(this,function(e){return t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),t.setAttribute("id","main-personal-projects"),i=document.createElement("label"),o=document.createElement("span"),i.appendChild(document.createTextNode("Some Personal Projects:")),o.appendChild(document.createTextNode("from Github")),o.classList.add("tooltip"),i.appendChild(o),n.appendChild(i),t.appendChild(n),o=(o=document.getElementById("main-languages"))||document.getElementById("main-about"),i=this.repositories.splice(0,this.maxProjects),a=i,0<this.topicIncludes.length&&(a=i.filter(function(e){return-1==c.hideProjects.indexOf(normalize(e.name))&&e.topics.some(function(e){return-1!=c.topicIncludes.indexOf(e)})}),PP_Item_Create.escaped_topics=this.topicIncludes),a.forEach(function(e){new PP_Item_Create(e).then(function(e){r.appendChild(e)})}),r.setAttribute("id","pp-list"),n.appendChild(r),NavigationPanel.addItem("Personal Projects","main-personal-projects"),o.parentNode.insertBefore(t,o.nextSibling),[2]})})},c.__is_initiated__=!1,c.username="",c}();function normalize(e){return String(e).replaceAll(/\s/g,"").toLowerCase()}function ObjectSort(t){var e=Object.keys(t).map(function(e){return{key:e,value:t[e]}}),n={};return(e=e.sort(function(e,t){return t.value-e.value})).forEach(function(e){return n[e.key]=e.value}),n}function safeConcat(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(e){return 0<String(e.trim()).length}).map(function(e){return String(e).trim().replace(/^\//,"").replace(/\/$/,"")}).join("/")}var Config=function(){function n(){var e=window.GLOBAL_ENV.pre_path;this.__url=safeConcat(window.location.origin,e,"config.json")}return n.prototype.load=function(t){return void 0===t&&(t=function(e){return e}),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,fetch(this.__url,{method:"GET",mode:"cors",cache:"force-cache",redirect:"follow",referrerPolicy:"no-referrer"}).then(function(e){return e.json()}).then(function(e){t(n.__config=e)}).catch(function(e){console.error(e)})];case 1:return e.sent(),[2]}})})},Object.defineProperty(n,"config",{get:function(){return n.__config},enumerable:!1,configurable:!0}),n.__config={},n}(),GH_API=function(){function l(e,t){if("number"!=typeof t||t<0)throw new TypeError("Expiration should be a positive number");this.__expiry__=t,this.__url__=e,this.__config__={method:"GET",mode:"cors",cache:"force-cache",referrerPolicy:"no-referrer"},""!=l.__auth_token__&&(this.__config__.headers=this.__config__.headers||{},this.__config__.headers.Authorization="token ".concat(l.__auth_token__))}return Object.defineProperty(l,"__auth_token__",{get:function(){return Config.config.github.auth_token},enumerable:!1,configurable:!0}),l.prototype.then=function(n,d){return void 0===d&&(d=!1),__awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(s,u){return __awaiter(t,void 0,void 0,function(){var t,n,r,o,i,a,c=this;return __generator(this,function(e){switch(e.label){case 0:t=this.__url__,e.label=1;case 1:return e.trys.push([1,3,,16]),[4,this.getFromDB(t,!1,function(e){s([e,!1])})];case 2:return e.sent(),[3,16];case 3:if("expired"!=(n=e.sent()).message&&"empty"!=n.message)throw n;if(r=function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getFromDB(t,!0,function(e){s(e?[e,!1]:[Object,!0])})];case 1:return e.sent(),[3,3];case 2:return e.sent(),s([Object,!0]),[3,3];case 3:return[2]}})})},!window.navigator.onLine)return"expired"==n.message?[2,r()]:[2,s([Object,!0])];e.label=4;case 4:return e.trys.push([4,14,,15]),[4,fetch(this.__url__,this.__config__)];case 5:switch(o=e.sent(),o.status){case 0:return[3,6];case 200:return[3,7];case 400:case 401:return[3,9];case 403:return[3,10]}return[3,12];case 6:return[2,s([Object,!0])];case 7:return[4,o.text()];case 8:i=e.sent(),i=JSON.parse(i),a=(new Date).getTime(),a+=36e5*this.__expiry__;try{return l.saveData(t,i,a),[2,s([i,!1])]}catch(e){return u(),[2]}return[3,13];case 9:return[2,r()];case 10:return"0"==String(o.headers.get("x-ratelimit-remaining"))?"expired"==n.message?[2,r()]:[2,s([Object,!0])]:[4,o.json()];case 11:return"unavailable"==e.sent().block.reason&&d?[2,s([Object,!0])]:(u(),[3,13]);case 12:console.error("fetch() returns ".concat(o.status," status code.")),e.label=13;case 13:return[3,15];case 14:return e.sent(),console.info("Ad blocker maybe turned on"),s([Object,!0]),[3,15];case 15:return u("No available resources"),[3,16];case 16:return[2]}})})}).then(function(e){n(e[0],e[1])})];case 1:return[2,e.sent()]}})})},l.prototype.getFromDB=function(r,o,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,l.__getDB__()];case 1:t=e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,t.getItem(r).then(function(e){e=JSON.parse(e);if(o)return i(e.data);try{if(Number(e.expiry)>=(new Date).getTime())return i(e.data)}catch(e){throw new Error("empty")}throw new Error("expired")}).catch(function(e){throw e})];case 3:return e.sent(),[3,5];case 4:if(n=e.sent(),-1!=["expired","empty"].indexOf(n.message))throw n;return[3,5];case 5:return[2]}})})},l.saveData=function(r,o,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,l.__getDB__()];case 1:t=e.sent(),n={save_time:(new Date).getTime(),data:o,expiry:i};try{t.setItem(r,JSON.stringify(n))}catch(e){throw e}return[2]}})})},l.__getDB__=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,localforage.createInstance({name:"gh_fetched",storeName:"urls",description:"Stored Data"})];case 1:return[2,e.sent()]}})})},l}();function gh_fetch(e,t){return new GH_API(e,t)}var getColors=function(){function r(){var e=window.GLOBAL_ENV.pre_path;this.__url=safeConcat(window.location.origin,e,"/assets/data/colors.json")}return r.prototype.then=function(t){return void 0===t&&(t=function(e){}),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,fetch(this.__url,{method:"GET",mode:"cors",cache:"force-cache",redirect:"follow",referrerPolicy:"no-referrer"}).then(function(e){return e.json()}).then(function(e){t(r.colors=e)})];case 1:return[2,e.sent()]}})})},r.color=function(t){try{return String(r.colors[t])}catch(e){for(var n in r.colors)if(String(n).trim().toLowerCase()==t.trim().toLowerCase())return String(r.colors[n])}return"#f0f0f0"},r}();